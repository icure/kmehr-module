version: "3.8"

services:
  couchdb:
    image: couchdb:3.4.2
    container_name: couchdb-test
    ports:
      - "${COUCHDB_PORT}:5984"
    volumes:
      - ./docker.ini/:/opt/couchdb/etc/local.d/docker.ini
    environment:
      - COUCHDB_USER=${COUCHDB_USER}
      - COUCHDB_PASSWORD=${COUCHDB_PASSWORD}
      - ERL_MAX_PORT=16384

  kraken-1:
    image: docker.taktik.be/icure/icure-kraken:26.1.24-g7b937bcd97
    container_name: kraken-1
    ports:
      - "5005:5005"
      - "8000:8000"
      - "16044:16043"
    environment:
      - ICURE_GROUPS_ADMINGROUP=xx
      - ICURE_COUCHDB_PREFIX=icure-__
      - ICURE_COUCHDB_URL=http://couchdb-test:5984
      - ICURE_COUCHDB_USERNAME=${COUCHDB_USER}
      - ICURE_COUCHDB_PASSWORD=${COUCHDB_PASSWORD}
      - ICURE_GCP_SERVICE_ACCOUNT_EMAIL=fake-account@taktik-icure.iam.gserviceaccount.com
      - ICURE_EXTERNALSERVICES_USEFAKES=true
      - ICURE_SYNC_GLOBAL_DATABASES=true
      - ICURE_RATELIMIT_RULES_0=/rest/v1/patient/register->10
      - ICURE_RATELIMIT_RULES_1=/rest/v1/user/register->10
      - "JWT_AUTH_PRIV_KEY=MIIEvAIBADANBgkqhkiG9w0BAQEFAASCBKYwggSiAgEAAoIBAQC0OrKirHb4MfCez9/vZUwI+Knpk+AyLV2PgKpHk9tafOKwkRYlr80wsj0J+YkdR9EjWEAN5g1dkWyzhZGmvtwDMP2W1LJ8xtQNPzTzr5llCVmps6YgGLkkHOksnEoLY9xgncsekS3sAjBybcsMRRXPxSvwVDOl5PetF7Jp/u/T7jHKYAixxZzo8tkQXFZ5XBhi+hYdT2IpoyrOBbhRa7CjVC5FHesUgdnDwtSwUqg4X10NGFkjDTZIf9aezZ0jbtLL+ENfsxBXrKBj8brCWrO+pcwITFt/vbU2PBFRhlF8o/GOs3FgwE8+psZoVTAK1lergQpIb5lvEVUpZXit+9IRAgMBAAECggEAAUT9E2GC3IRwiRPWhFeKsbD7tGgc3wmcBDngKS0o0UI6MAtzlBwhBj/pJ2f1L+o8tkKlv9tQGom+0eRl1l53iwO2M5DnuXKGlZnNgA5rdo9abPQ1njoCWtdjypNGv74KNDmET+CuqcAJspKkqJ9XdB1TzgdvzjI2zuaw9Gdt7ciXipTHZ8Hv/i7j+lqT2gLuN8KgB3kcHwj8LIpCUsxhvtLwTaa7up+gCkRYQvr3VyhtgRi2LDPXDB9UzJEPA+FQHHt4CGte32nncYKN0Sb/H4ErfcWJ9g8jTRz+flOohM3GFwx0koEZWZUm4jWL9uO6/Q50/iL9YyXzZ9+4TzkQKQKBgQC18ZCq7agzB7ZjGojGeHZW729Oj4b/YZomrS8vHNyv5vnPTmZZ7SNVXqXu7m5bHdvasY5NmlV/fH4cfau2+Kcyhxc72dJJoXw1s7RPUvuQWnD9gWBqqEJjDmCz08MjNEP68bMl0tM3BHMBF83+TfntNyvEiaWjoB624RK6Ys7+iQKBgQD9loA1v30Bjh3NGVtiwd4SlsZNxdrpUjN2fi4pyeZAvjEfw1STGtVzDi4A9Wi7q4WRdLiv3vHxdnalCxkejvlDocsL4f0sl/NbABkxF3AtTbkAv1TmvGRQj4j0FcRgJSLzdCVz/ZNWGVfnxkXMW38b5N7G1kxWpERRKCh+sHQVSQKBgB1lq4dCoQOlwl1e4yyWOCCxzR03aYuH3J1VLCODmVC+lCxfsX/kJepcQZlKYwBL4cMDH0gAoMHZfpLh50XIBVPPqfxcpHKLKgOPRpnugYEAa/M53Tc+eoOAxjUoCQZ+ImHAfb6lwsTH7kEF9J2bQb+HQ4Yc62t1qqDH2vvMjT9pAoGANRWHOzkdmvC8Dk4rki3RJgUH+And/I+nlDtvwHGyUIU/1U1Xa//nBNHIEY1N4lNSf5N2geJitVA+H+iF1p7JUT4SOieRjv80Ay2vGFa2tdUaUCy9QhvXyAF0Atx3okTD30DGAlTnvdNKUotv2wqgPh+X/vmnO0/huTd12qdndXkCgYA81m60AJAuo72dMT8Cd6NWF8Dz8RD9YqxY9oJdJBe8r17vkn7sEevclCWl+UXnM2pB70h2KSKcim0WH9Ijy/9qbkhMD+Ab7xkS+zIfbX+OU6cfi+C9tsBSYyjgRfGwhNYIu1b1MuNkmF7cDwCUoBxHR2o8tZCsGenL6ijcUtKOSw=="
      - "JWT_AUTH_PUB_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtDqyoqx2+DHwns/f72VMCPip6ZPgMi1dj4CqR5PbWnzisJEWJa/NMLI9CfmJHUfRI1hADeYNXZFss4WRpr7cAzD9ltSyfMbUDT8086+ZZQlZqbOmIBi5JBzpLJxKC2PcYJ3LHpEt7AIwcm3LDEUVz8Ur8FQzpeT3rReyaf7v0+4xymAIscWc6PLZEFxWeVwYYvoWHU9iKaMqzgW4UWuwo1QuRR3rFIHZw8LUsFKoOF9dDRhZIw02SH/Wns2dI27Sy/hDX7MQV6ygY/G6wlqzvqXMCExbf721NjwRUYZRfKPxjrNxYMBPPqbGaFUwCtZXq4EKSG+ZbxFVKWV4rfvSEQIDAQAB"
      - "JWT_REFRESH_PRIV_KEY=MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQD1OPDi09K2BQC2uMQlRMBIKyKnRPYxetwrgZ7lHR4MroJc5hPvG/Rp2TTcgTHb6yD5O8EswxXHjeltEZAxc5Dgqx/8ht5xaRdYsMkH6sysmqdviSZYOK66NdQ29aYGPv6JXlSzc31gK5LsmLhEOXGQAjqIpAERLDdccgeZNRa0e8OGhUJUJ8UL0AS5kZfVGmPQGAKDLUmff+g8QF6tnJj+uf1URGCdaLIUB1FZQ5wI8yKOA7Wcql2Tpg/qFk2dgdkeo3QoR24H7glSbLXMskPm3BdZbDkXjIIgH+HIsuJBWpLbLZfVRvb0JQDddJzFW2ybx4haOkTD2WTWhPYzn8bFAgMBAAECggEAEw/ylcdelVytMgcJ5FXEVrfXsUYIl08UJ2OjnO7XA6hbJOqTuR4ksUe7trpqTEyqWwV8nkSqAEG1WA+p9FYl+HkE+wXm68z+Dhxr/CwR7gb1phN0wh3h40LE9OLCnbCu67HEBtEe+WdZu/+hL1iBze6Ga1HIbXPQ9+Q7V/sLAUuIseOsO7Sebgu0lmVAN38TyBH3nGF69VEXQ391AVbIXbamTNbIo8fnokrUtpXw1yuyX0IZ2zGPMW/GYZGD+3FxjlWgOdTivkf0v8EA7evAyptDhpa3keLK+42P6mV7v7BKLR6q6tkbfZCw8yTRP0zlCKM3W8t6enhdPr6rvKqA4QKBgQD3OHhKCXLDrPK8DFGsQ/OXDprNXV1Gm/FNNnWlp4lPycOjj1ygv1Y4ZPDuQwd0jLHF2iyVch/Z/eaYC438MdyB9z1k5+ALfEZJ4VLGgQbJ+qa5hWO9zCUc9bgjX+HkRFk7kdnNVdjlhisgkTCbpY4koWlyJZt6UHbLZjflxuL3lQKBgQD97k4wRthf7uzUZH7T79vJjrlMPs62nlm8/MLIdffdOCCV2AvhaAHFef/zNXUxJyeU4nLlTu0vpF9S0Uv3BbeH9UPPnJuEDdf8j4pPbZrOwJA2XTRESlsD3R46rjEjhEB8ujjuLLd96Uf23lrZPqX+aPSv3s0OvlDzYZT5JFcGcQKBgDx3DkylZPFg8nl11d/5OrG+e7Qw2qhzaaBF6p5ajKX8JiJx5OjYA2GFprvPnxotcyl+BBuFLy8k/2o+oTqGg3UyIEz2vYBxo8tcFd/BHQT3jiGf81YvgQBFRQU55UjsQprkQE4NaiAxIYk0mZvn8Q0agWzOr+lJltSGqrNDYq3FAoGBAPMV+H+6slRUEx/X/JnC2nJ/UN+umJC10k5a4dSpKdj6bCdGJUlpGZkEC4O1vzSIuRmMFlVyUxjyj9ZmSgR10pYysvHCiBXIcuVyPAOBd1tJeESywOBHFg4C1XdzXdMUPe+pDerjn9zHP38SqYGiuaFstCDQdxkQE8qJteUzZqPhAoGAfVFQ3rmnseuywQCwbl50DvcDDp1MCvneGCjeLwbTwYZ6BWG4C0taLBloFnuKQZwNVJbNmjXF6MIHV6NUUr+SD6OQ36FEGrI2rWrxJXvzRzsg4JH4Ltk4HyGCarf8jAOU/kkjXIQ1FNNpmbn02+pD89XFSo1beok6uVqQG0mK8Wg="
      - "JWT_REFRESH_PUB_KEY=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA9Tjw4tPStgUAtrjEJUTASCsip0T2MXrcK4Ge5R0eDK6CXOYT7xv0adk03IEx2+sg+TvBLMMVx43pbRGQMXOQ4Ksf/IbecWkXWLDJB+rMrJqnb4kmWDiuujXUNvWmBj7+iV5Us3N9YCuS7Ji4RDlxkAI6iKQBESw3XHIHmTUWtHvDhoVCVCfFC9AEuZGX1Rpj0BgCgy1Jn3/oPEBerZyY/rn9VERgnWiyFAdRWUOcCPMijgO1nKpdk6YP6hZNnYHZHqN0KEduB+4JUmy1zLJD5twXWWw5F4yCIB/hyLLiQVqS2y2X1Ub29CUA3XScxVtsm8eIWjpEw9lk1oT2M5/GxQIDAQAB"

    depends_on:
      - couchdb

# => ./docker.ini
# [chttpd]
# bind_address = 0.0.0.0
# port = 5984
# server_options = [{backlog, 128}, {acceptor_pool_size, 24}, {max, 16384}]
# [cluster]
# n = 1
# [couchdb]
# js_engine = quickjs
